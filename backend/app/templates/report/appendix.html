{% extends "report/base.html" %}

{% block content %}
<!-- Complete State Summary Page -->
<div class="page">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-left">
            {% if logo_data_uri %}
            <img src="{{ logo_data_uri }}" alt="Logo" class="page-header-logo" />
            {% else %}
            <svg width="80" height="32" viewBox="0 0 180 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 60L30 12L55 60H45L40 50H20L15 60H5Z" fill="#c8102e"/>
                <path d="M30 22L37 40H23L30 22Z" fill="white"/>
                <text x="60" y="55" font-family="Segoe UI, Arial, sans-serif" font-size="48" font-weight="800" font-style="italic" fill="white">S</text>
                <text x="95" y="55" font-family="Segoe UI, Arial, sans-serif" font-size="48" font-weight="800" font-style="italic" fill="white">T</text>
            </svg>
            {% endif %}
            <div class="page-header-title">
                <h1>NEXUS ANALYSIS REPORT</h1>
                <div class="subtitle">Sales Tax Nexus Determination & Liability Assessment</div>
            </div>
        </div>
    </div>

    <div class="page-content">
        <h2>Complete State Summary</h2>
        <p class="text-muted text-small mb-1">
            Full list of all states with sales activity during the analysis period.
        </p>

        <table class="summary-table">
            <thead>
                <tr>
                    <th>State</th>
                    <th class="text-center">Status</th>
                    <th class="text-right">Total Sales</th>
                    <th class="text-right">Threshold</th>
                    <th class="text-center">% of Threshold</th>
                    <th class="text-right">Est. Liability</th>
                </tr>
            </thead>
            <tbody>
                {% for state in all_states %}
                <tr>
                    <td>
                        <span class="status-dot {% if state.nexus_status == 'has_nexus' %}red{% elif state.nexus_status == 'approaching' %}yellow{% else %}green{% endif %}"></span>
                        {{ state.state_name }}
                    </td>
                    <td class="text-center">
                        {% if state.nexus_status == 'has_nexus' %}
                        <strong style="color: #c8102e;">Nexus</strong>
                        {% elif state.nexus_status == 'approaching' %}
                        <span style="color: #d97706;">Approaching</span>
                        {% else %}
                        <span style="color: #059669;">No Nexus</span>
                        {% endif %}
                    </td>
                    <td class="text-right currency">${{ "{:,.0f}".format(state.total_sales) }}</td>
                    <td class="text-right currency">${{ "{:,.0f}".format(state.threshold) }}</td>
                    <td class="text-center">{{ state.threshold_percent | round(0) | int }}%</td>
                    <td class="text-right currency font-bold">
                        {% if state.estimated_liability > 0 %}
                        ${{ "{:,.0f}".format(state.estimated_liability) }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="data-card mt-2">
            <h4>Data Period Summary</h4>
            <div class="data-row">
                <span class="data-label">Analysis Period</span>
                <span class="data-value">
                    {% if period_start and period_end %}
                    {{ period_start }} - {{ period_end }}
                    {% else %}
                    As of {{ report_date }}
                    {% endif %}
                </span>
            </div>
            <div class="data-row">
                <span class="data-label">Total Transactions Analyzed</span>
                <span class="data-value">{{ "{:,}".format(total_transactions) }}</span>
            </div>
            <div class="data-row">
                <span class="data-label">States with Activity</span>
                <span class="data-value">{{ states_with_activity }}</span>
            </div>
            <div class="data-row">
                <span class="data-label">Report Generated</span>
                <span class="data-value">{{ report_date }}</span>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="page-footer">
        <span>PREPARED BY: AST | Advisory & Compliance | www.NexusCheck.com</span>
        <span class="page-number">PAGE</span>
    </div>
</div>

<!-- Methodology Page -->
<div class="page">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-left">
            {% if logo_data_uri %}
            <img src="{{ logo_data_uri }}" alt="Logo" class="page-header-logo" />
            {% else %}
            <svg width="80" height="32" viewBox="0 0 180 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 60L30 12L55 60H45L40 50H20L15 60H5Z" fill="#c8102e"/>
                <path d="M30 22L37 40H23L30 22Z" fill="white"/>
                <text x="60" y="55" font-family="Segoe UI, Arial, sans-serif" font-size="48" font-weight="800" font-style="italic" fill="white">S</text>
                <text x="95" y="55" font-family="Segoe UI, Arial, sans-serif" font-size="48" font-weight="800" font-style="italic" fill="white">T</text>
            </svg>
            {% endif %}
            <div class="page-header-title">
                <h1>NEXUS ANALYSIS REPORT</h1>
                <div class="subtitle">Sales Tax Nexus Determination & Liability Assessment</div>
            </div>
        </div>
    </div>

    <div class="page-content">
        <h2>Methodology</h2>

        <div class="methodology-section">
            <h4>Nexus Determination</h4>
            <p>
                Nexus Determination is the states enroot research over nexus ans regoomasisevowed
                nexus duo mimitation rasurus coloures or callnao nest in rliaib ofl anotmlies,
                aqrises, econviens to tnow, codersmatime, isas poop wranshas the manpet
                poeiment in navvelne mondref orvesespmlon of seccilsling obfhone,
                Assessment answers. [source: 156].
            </p>
        </div>

        <div class="methodology-section">
            <h4>Liability Estimation</h4>
            <p>
                Liability Estimation is established foal oderos onere mx taxoro assess liability
                Estimation to nesol price that the amnuaoref mimntory doctiatr seacilsling obfhone,
                econowooded in r riecent mondrefeon & liability requests. [source: 156-151].
            </p>
        </div>

        <div class="methodology-section">
            <h4>VDA Savings Calculation</h4>
            <p>
                VDA Savings Calculation is the calculaorator average number of coloente traoles
                penalties. Consider management colivent whory development in bon, VDA
                savings calculart and anmtend and convvert savinos procedures. [source: 130-151].
            </p>
        </div>

        <div class="methodology-section">
            <h4>Filing Frequency</h4>
            <p>
                Filing Frequency is siminical nexus determnings the commony bis-pear liability
                commenationald and filing frequency, as the corren ned-simiesdatislosucalve filing
                mubosces al oci tke soving interrop or orap-anep, aftermath-stin filing frequency.
                [source: 136-151].
            </p>
        </div>

        <div class="section-divider"></div>

        <h2>Disclaimers</h2>

        <div class="disclaimer-box">
            <h4>Important Notice</h4>
            <p>
                This grotes ocomotor documents and errors of occomeration, and c.est vesus
                determnings artual imusremants and extinity purposes. By isternationsons on concept
                difficly er generahos, with y antomoents, dociuments. 0 sensotrenal ans impone
                encudes an ocardontons on voluosomaintonat narinwost ilusteclure econnanets and
                additonal teisourees. [sources: 153-157]
            </p>
            <p class="mt-1">
                This Diclatoner is pinvideto to the compllevatilons enconderton are most
                underscoatable cver ensmisslanents and macirataciuve of tis fvl
                envousaballetect cver enshissments. Sources. All thise dependonos are mouphtd
                moreve, we Foroldter dociuments rainly estnvatded at adrbon and ssoline florpotions
                and liability sortration and ratio exitivation provitied massasrenuret in this
                chainuines. [source: 153-157]
            </p>
        </div>

        {% if preparer_name or preparer_firm %}
        <div class="data-card mt-2">
            <h4>Report Prepared By</h4>
            <div class="data-row">
                {% if preparer_name %}
                <span class="data-label">Preparer</span>
                <span class="data-value">{{ preparer_name }}</span>
                {% endif %}
            </div>
            {% if preparer_firm %}
            <div class="data-row">
                <span class="data-label">Firm</span>
                <span class="data-value">{{ preparer_firm }}</span>
            </div>
            {% endif %}
            <div class="data-row">
                <span class="data-label">Date</span>
                <span class="data-value">{{ report_date }}</span>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Footer -->
    <div class="page-footer">
        <span>PREPARED BY: AST | Advisory & Compliance | www.NexusCheck.com</span>
        <span class="page-number">PAGE</span>
    </div>
</div>
{% endblock %}
